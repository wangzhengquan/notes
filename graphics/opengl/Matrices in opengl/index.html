<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://wangzhengquan.github.io/notes/graphics/opengl/Matrices%20in%20opengl/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.3.9"><title>Matrices in opengl - 笔记</title><link rel=stylesheet href=../../../assets/stylesheets/main.1d29e8d0.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=none data-md-color-accent=none> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#homogeneous-coordinates class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=笔记 class="md-header__button md-logo" aria-label=笔记 data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 笔记 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Matrices in opengl </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=笔记 class="md-nav__button md-logo" aria-label=笔记 data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> 笔记 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> 简介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> OS (xv6) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="OS (xv6)" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> OS (xv6) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../xv6/ class=md-nav__link> xv6简介 </a> </li> <li class=md-nav__item> <a href=../../../xv6/boot_loader/ class=md-nav__link> Boot loader </a> </li> <li class=md-nav__item> <a href=../../../xv6/entry_%20kernel/ class=md-nav__link> Entry kernel </a> </li> <li class=md-nav__item> <a href=../../../xv6/scheduler/ class=md-nav__link> Scheduler </a> </li> <li class=md-nav__item> <a href=../../../xv6/the_first_process/ class=md-nav__link> 第一个进程 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_6 type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6> 中断 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=中断 data-md-level=2> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> 中断 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../xv6/interrups_process/ class=md-nav__link> 中断处理流程 </a> </li> <li class=md-nav__item> <a href=../../../xv6/system_call/ class=md-nav__link> 系统调用 </a> </li> <li class=md-nav__item> <a href=../../../xv6/timer_interrupt/ class=md-nav__link> 时间中断 </a> </li> <li class=md-nav__item> <a href=../../../xv6/disk_interrupt/ class=md-nav__link> 硬盘中断 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../xv6/file_system/ class=md-nav__link> 文件系统 </a> </li> <li class=md-nav__item> <a href=../../../xv6/device/ class=md-nav__link> 设备管理 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Math <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Math data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Math </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../math/Rodrigues%27%20rotation/Rodrigues%27%20rotation/ class=md-nav__link> Rodrigues' rotation </a> </li> <li class=md-nav__item> <a href=../../../math/Quaternions/Quaternions/ class=md-nav__link> Quaternions </a> </li> <li class=md-nav__item> <a href=../../../math/Windowing%20transformations/ class=md-nav__link> Windowing transformations </a> </li> <li class=md-nav__item> <a href=../../../math/distance%20from%20point%20to%20plane/ class=md-nav__link> distance from point to plane </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> graphics <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=graphics data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> graphics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Data%20shared%20between%20CPU%20and%20GPU/ class=md-nav__link> Data shared between CPU and GPU </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Matrices in opengl <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Matrices in opengl </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#homogeneous-coordinates class=md-nav__link> Homogeneous coordinates </a> </li> <li class=md-nav__item> <a href=#translation-matrices class=md-nav__link> Translation matrices </a> </li> <li class=md-nav__item> <a href=#the-identity-matrix class=md-nav__link> The Identity matrix </a> </li> <li class=md-nav__item> <a href=#scaling-matrices class=md-nav__link> Scaling matrices </a> </li> <li class=md-nav__item> <a href=#rotation-matrices class=md-nav__link> Rotation matrices </a> </li> <li class=md-nav__item> <a href=#cumulating-transformations class=md-nav__link> Cumulating transformations </a> </li> <li class=md-nav__item> <a href=#the-model-view-and-projection-matrices class=md-nav__link> The Model, View and Projection matrices </a> <nav class=md-nav aria-label="The Model, View and Projection matrices"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-model-matrix class=md-nav__link> The Model matrix </a> </li> <li class=md-nav__item> <a href=#the-view-matrix class=md-nav__link> The View matrix </a> </li> <li class=md-nav__item> <a href=#the-projection-matrix class=md-nav__link> The Projection matrix </a> </li> <li class=md-nav__item> <a href=#cumulating-transformations-the-modelviewprojection-matrix class=md-nav__link> Cumulating transformations: the ModelViewProjection matrix </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#putting-it-all-together class=md-nav__link> Putting it all together </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href="../VBO/ Indexing.md" class=md-nav__link> VBO Indexing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> network <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=network data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> network </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../network/tcp/ class=md-nav__link> TCP </a> </li> <li class=md-nav__item> <a href=../../../network/icmp/ class=md-nav__link> ICMP </a> </li> <li class=md-nav__item> <a href=../../../network/dns/ class=md-nav__link> DNS </a> </li> <li class=md-nav__item> <a href=../../../network/dhcp/ class=md-nav__link> DHCP </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> database <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=database data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> database </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../database/sql/ class=md-nav__link> SQL </a> </li> <li class=md-nav__item> <a href=../../../database/B%2B%20Tree/B%2B%20Tree/ class=md-nav__link> B+ Tree </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#homogeneous-coordinates class=md-nav__link> Homogeneous coordinates </a> </li> <li class=md-nav__item> <a href=#translation-matrices class=md-nav__link> Translation matrices </a> </li> <li class=md-nav__item> <a href=#the-identity-matrix class=md-nav__link> The Identity matrix </a> </li> <li class=md-nav__item> <a href=#scaling-matrices class=md-nav__link> Scaling matrices </a> </li> <li class=md-nav__item> <a href=#rotation-matrices class=md-nav__link> Rotation matrices </a> </li> <li class=md-nav__item> <a href=#cumulating-transformations class=md-nav__link> Cumulating transformations </a> </li> <li class=md-nav__item> <a href=#the-model-view-and-projection-matrices class=md-nav__link> The Model, View and Projection matrices </a> <nav class=md-nav aria-label="The Model, View and Projection matrices"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-model-matrix class=md-nav__link> The Model matrix </a> </li> <li class=md-nav__item> <a href=#the-view-matrix class=md-nav__link> The View matrix </a> </li> <li class=md-nav__item> <a href=#the-projection-matrix class=md-nav__link> The Projection matrix </a> </li> <li class=md-nav__item> <a href=#cumulating-transformations-the-modelviewprojection-matrix class=md-nav__link> Cumulating transformations: the ModelViewProjection matrix </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#putting-it-all-together class=md-nav__link> Putting it all together </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <blockquote> <p>_The engines don’t move the ship at all. The ship stays where it is and the engines move the universe around it. ---- Futurama</p> </blockquote> <h2 id=homogeneous-coordinates>Homogeneous coordinates</h2> <p>Until then, we only considered 3D vertices as a <code>(x,y,z)</code> triplet. Let’s introduce w. We will now have <code>(x,y,z,w)</code> vectors.</p> <p>This will be more clear soon, but for now, just remember this: - If w == 1, then the vector (x,y,z,1) is a position in space. - If w == 0, then the vector (x,y,z,0) is a direction.</p> <p>(In fact, remember this forever.)</p> <p>What difference does this make? Well, for a rotation, it doesn’t change anything. When you rotate a point or a direction, you get the same result. However, for a translation (when you move the point in a certain direction), things are different. What could mean “translate a direction”? Not much.</p> <p>Homogeneous coordinates allow us to use a single mathematical formula to deal with these two cases.</p> <h2 id=translation-matrices>Translation matrices</h2> <p>These are the most simple tranformation matrices to understand. A translation matrix look like this:</p> <p><img alt src=../images/matrices_in_ogl/translationMatrix.png> where X,Y,Z are the values that you want to add to your position.</p> <p>So if we want to translate the vector (10,10,10,1) of 10 units in the X direction, we get:</p> <p><img alt src=../images/matrices_in_ogl/translationExamplePosition1.png> …and we get a (20,10,10,1) homogeneous vector! Remember, the 1 means that it is a position, not a direction. So our transformation didn’t change the fact that we were dealing with a position, which is good.</p> <p>Let’s now see what happens to a vector that represents a direction towards the -z axis: (0,0,-1,0)</p> <p><img alt src=../images/matrices_in_ogl/translationExampleDirection1.png></p> <p>…i.e. our original (0,0,-1,0) direction, which is great because, as I said earlier, moving a direction does not make sense.</p> <p>So, how does this translate to code?</p> <p><strong>In C++, with GLM:</strong></p> <pre><code class=language-c++>#include &lt;glm/gtx/transform.hpp&gt; // after &lt;glm/glm.hpp&gt;

glm::mat4 myMatrix = glm::translate(glm::mat4(), glm::vec3(10.0f, 0.0f, 0.0f));
glm::vec4 myVector(10.0f, 10.0f, 10.0f, 0.0f);
glm::vec4 transformedVector = myMatrix * myVector; // guess the result
</code></pre> <p><strong>In GLSL:</strong></p> <pre><code class=language-c>vec4 transformedVector = myMatrix * myVector;
</code></pre> <p>Well, in fact, you almost never do this in GLSL. Most of the time, you use <code>glm::translate()</code> in C++ to compute your matrix, send it to GLSL, and do only the multiplication.</p> <h2 id=the-identity-matrix>The Identity matrix</h2> <p>This one is special. It doesn’t do anything. But I mention it because it’s as important as knowing that multiplying A by 1.0 gives A.</p> <p><img alt src=../images/matrices_in_ogl/identityExample.png></p> <p><strong>In C++:</strong></p> <pre><code class=language-c++>glm::mat4 myIdentityMatrix = glm::mat4(1.0f);
</code></pre> <h2 id=scaling-matrices>Scaling matrices</h2> <p>Scaling matrices are quite easy too:</p> <p><img alt src=../images/matrices_in_ogl/scalingMatrix.png></p> <p>So if you want to scale a vector (position or direction, it doesn’t matter) by 2.0 in all directions:</p> <p><img alt src=../images/matrices_in_ogl/scalingExample.png></p> <p>and the w still didn’t change. You may ask: what is the meaning of “scaling a direction”? Well, often, not much, so you usually don’t do such a thing, but in some (rare) cases it can be handy.</p> <p>(notice that the identity matrix is only a special case of scaling matrices, with (X,Y,Z) = (1,1,1). It’s also a special case of translation matrix with (X,Y,Z)=(0,0,0), by the way)</p> <p><strong>In C++:</strong></p> <pre><code class=language-c++>// Use #include &lt;glm/gtc/matrix_transform.hpp&gt; and #include &lt;glm/gtx/transform.hpp&gt;
glm::mat4 myScalingMatrix = glm::scale(glm::mat4(1), glm::vec3(2,2,2));
</code></pre> <h2 id=rotation-matrices>Rotation matrices</h2> <p>These are quite complicated. I’ll skip the details here, as it’s not important to know their exact layout for everyday use. For more information, please have a look to the <a href=https://www.opengl-tutorial.org/assets/faq_quaternions/index.html>Matrices and Quaternions FAQ</a> (popular resource, probably available in your language as well). You can also have a look at the <a href=https://www.opengl-tutorial.org/intermediate-tutorials/tutorial-17-quaternions>Rotations tutorials</a>.</p> <p><strong>In C++:</strong></p> <pre><code class=language-c++>// Use #include &lt;glm/gtc/matrix_transform.hpp&gt; and #include &lt;glm/gtx/transform.hpp&gt;
glm::vec3 myRotationAxis(??,??,??);
glm::rotate( angle_in_degrees, myRotationAxis );
</code></pre> <h2 id=cumulating-transformations>Cumulating transformations</h2> <p>So now we know how to rotate, translate, and scale our vectors. It would be great to combine these transformations. This is done by multiplying the matrices together, for instance:</p> <pre><code>TransformedVector = TranslationMatrix * RotationMatrix * ScaleMatrix * OriginalVector;
</code></pre> <p><strong>!!! BEWARE!!!</strong> This lines actually performs the scaling FIRST, and THEN the rotation, and THEN the translation. This is how matrix multiplication works.</p> <p>Try it yourself:</p> <ul> <li> <p>make one step ahead (beware of your computer) and turn left;</p> </li> <li> <p>turn left, and make one step ahead</p> </li> </ul> <p>Writing the operations in another order wouldn’t produce the same result. As a matter of fact, the order above is what you will usually need for game characters and other items: Scale it first if needed; then set its direction, then translate it. For instance, given a ship model (rotations have been removed for simplification):</p> <ul> <li>The wrong way:<ul> <li>You translate the ship by (10,0,0). Its center is now at 10 units of the origin.</li> <li>You scale your ship by 2. Every coordinate is multiplied by 2 <em>relative to the origin</em>, which is far away… So you end up with a big ship, but centered at 2*10 = 20. Which you don’t want.</li> </ul> </li> <li>The right way:<ul> <li>You scale your ship by 2. You get a big ship, centered on the origin.</li> <li>You translate your ship. It’s still the same size, and at the right distance.</li> </ul> </li> </ul> <p>Matrix-matrix multiplication is very similar to matrix-vector multiplication, so I’ll once again skip some details and redirect you the the <a href=https://www.opengl-tutorial.org/assets/faq_quaternions/index.html#Q11>Matrices and Quaternions FAQ</a> if needed. For now, we’ll simply ask the computer to do it:</p> <p><strong>in C++, with GLM:</strong></p> <pre><code class=language-c++>glm::mat4 myModelMatrix = myTranslationMatrix * myRotationMatrix * myScaleMatrix;
glm::vec4 myTransformedVector = myModelMatrix * myOriginalVector;
</code></pre> <p><strong>in GLSL:</strong></p> <pre><code>mat4 transform = mat2 * mat1;
vec4 out_vec = transform * in_vec;
</code></pre> <h1 id=the-model-view-and-projection-matrices>The Model, View and Projection matrices</h1> <p><em>For the rest of this tutorial, we will suppose that we know how to draw Blender’s favourite 3d model: the monkey Suzanne.</em></p> <p>The Model, View and Projection matrices are a handy tool to separate transformations cleanly. </p> <h2 id=the-model-matrix>The Model matrix</h2> <p>This model, just as our beloved red triangle, is defined by a set of vertices. The X,Y,Z coordinates of these vertices are defined relative to the object’s center: that is, if a vertex is at (0,0,0), it is at the center of the object.</p> <p><img alt src=../images/matrices_in_ogl/model.png></p> <p>We’d like to be able to move this model, maybe because the player controls it with the keyboard and the mouse. Easy, you just learnt do do so: <code>translation\*rotation\*scale</code>, and done. You apply this matrix to all your vertices at each frame (in GLSL, not in C++!) and everything moves. Something that doesn’t move will be at the <em>center of the world</em>.</p> <p><img alt src=../images/matrices_in_ogl/world.png></p> <p>Your vertices are now in <em>World Space</em>. This is the meaning of the black arrow in the image below: <em>We went from Model Space (all vertices defined relatively to the center of the model) to World Space (all vertices defined relatively to the center of the world).</em></p> <p><img alt src=../images/matrices_in_ogl/model_to_world.png></p> <p>We can sum this up with the following diagram:</p> <p><img alt src=../images/matrices_in_ogl/M.png></p> <h2 id=the-view-matrix>The View matrix</h2> <p>Let’s quote Futurama again:</p> <blockquote> <p><em>The engines don’t move the ship at all. The ship stays where it is and the engines move the universe around it.</em></p> </blockquote> <p><img alt src=../images/matrices_in_ogl/camera.png></p> <p>So initially your camera is at the origin of the World Space. In order to move the world, you simply introduce another matrix. Let’s say you want to move your camera of 3 units to the right (+X). This is equivalent to moving your whole world (meshes included) 3 units to the LEFT! (-X). While you brain melts, let’s do it:</p> <pre><code class=language-c++>// Use #include &lt;glm/gtc/matrix_transform.hpp&gt; and #include &lt;glm/gtx/transform.hpp&gt;
glm::mat4 ViewMatrix = glm::translate(glm::mat4(), glm::vec3(-3.0f, 0.0f ,0.0f));
</code></pre> <p>Again, the image below illustrates this: <em>We went from World Space (all vertices defined relatively to the center of the world, as we made so in the previous section) to Camera Space (all vertices defined relatively to the camera).</em></p> <p><img alt src=../images/matrices_in_ogl/model_to_world_to_camera.png></p> <p>Before you head explodes from this, enjoy GLM’s great <code>glm::lookAt</code> function:</p> <pre><code class=language-c++>glm::mat4 CameraMatrix = glm::lookAt(
    cameraPosition, // the position of your camera, in world space
    cameraTarget,   // where you want to look at, in world space
    upVector        // probably glm::vec3(0,1,0), but (0,-1,0) would make you looking upside-down, which can be great too
);
</code></pre> <p>Here’s the compulsory diagram:</p> <p><img alt src=../images/matrices_in_ogl/MV.png></p> <p>This is not over yet, though.</p> <h2 id=the-projection-matrix>The Projection matrix</h2> <p>We’re now in Camera Space. This means that after all theses transformations, a vertex that happens to have <code>x==0</code> and <code>y==0</code> should be rendered at the center of the screen. But we can’t use only the x and y coordinates to determine where an object should be put on the screen: its distance to the camera (z) counts, too! For two vertices with similar x and y coordinates, the vertex with the biggest z coordinate will be more on the center of the screen than the other.</p> <p>This is called a perspective projection:</p> <p><img alt src=../images/matrices_in_ogl/model_to_world_to_camera_to_homogeneous.png></p> <p>And luckily for us, a 4x4 matrix can represent this projection:</p> <pre><code class=language-c++>// Generates a really hard-to-read matrix, but a normal, standard 4x4 matrix nonetheless
glm::mat4 projectionMatrix = glm::perspective(
    glm::radians(FoV), // The vertical Field of View, in radians: the amount of &quot;zoom&quot;. Think &quot;camera lens&quot;. Usually between 90° (extra wide) and 30° (quite zoomed in)
    4.0f / 3.0f,       // Aspect Ratio. Depends on the size of your window. Notice that 4/3 == 800/600 == 1280/960, sounds familiar?
    0.1f,              // Near clipping plane. Keep as big as possible, or you'll get precision issues.
    100.0f             // Far clipping plane. Keep as little as possible.
);
</code></pre> <p>One last time:</p> <p><em>We went from Camera Space (all vertices defined relatively to the camera) to Homogeneous Space (all vertices defined in a small cube. Everything inside the cube is onscreen).</em></p> <p>And the final diagram:</p> <p><img alt src=../images/matrices_in_ogl/MVP.png></p> <p>Here’s another diagram so that you understand better what happens with this Projection stuff. Before projection, we’ve got our blue objects, in Camera Space, and the red shape represents the frustum of the camera: the part of the scene that the camera is actually able to see.</p> <p><img alt src=../images/matrices_in_ogl/nondeforme.png></p> <p>Multiplying everything by the Projection Matrix has the following effect:</p> <p><img alt src=../images/matrices_in_ogl/homogeneous.png></p> <p>In this image, the frustum is now a perfect cube (between -1 and 1 on all axes, it’s a little bit hard to see it), and all blue objects have been deformed in the same way. Thus, the objects that are near the camera ( = near the face of the cube that we can’t see) are big, the others are smaller. Seems like real life!</p> <p>Let’s see what it looks like from the “behind” the frustum:</p> <p><img alt src=../images/matrices_in_ogl/projected1.png></p> <p>Here you get your image! It’s just a little bit too square, so another mathematical transformation is applied (this one is automatic, you don’t have to do it yourself in the shader) to fit this to the actual window size:</p> <p><img alt src=../images/matrices_in_ogl/final1.png></p> <p>And this is the image that is actually rendered!</p> <h2 id=cumulating-transformations-the-modelviewprojection-matrix>Cumulating transformations: the ModelViewProjection matrix</h2> <p>…Just a standard matrix multiplication as you already love them!</p> <pre><code class=language-c++>// C++: compute the matrix
glm::mat4 MVPmatrix = projection * view * model; // Remember: inverted!
</code></pre> <pre><code>// GLSL: apply it
transformed_vertex = MVP * in_vertex;
</code></pre> <h1 id=putting-it-all-together>Putting it all together</h1> <ul> <li>First step: include the GLM GTC matrix transform functions:</li> </ul> <pre><code class=language-c++>#include &lt;glm/gtc/matrix_transform.hpp&gt;
</code></pre> <ul> <li>Second step: generating our MVP matrix. This must be done for each model you render.</li> </ul> <pre><code class=language-c++>// Projection matrix: 45° Field of View, 4:3 ratio, display range: 0.1 unit &lt;-&gt; 100 units
glm::mat4 Projection = glm::perspective(glm::radians(45.0f), (float) width / (float)height, 0.1f, 100.0f);

// Or, for an ortho camera:
//glm::mat4 Projection = glm::ortho(-10.0f,10.0f,-10.0f,10.0f,0.0f,100.0f); // In world coordinates

// Camera matrix
glm::mat4 View = glm::lookAt(
    glm::vec3(4,3,3), // Camera is at (4,3,3), in World Space
    glm::vec3(0,0,0), // and looks at the origin
    glm::vec3(0,1,0)  // Head is up (set to 0,-1,0 to look upside-down)
    );

// Model matrix: an identity matrix (model will be at the origin)
glm::mat4 Model = glm::mat4(1.0f);
// Our ModelViewProjection: multiplication of our 3 matrices
glm::mat4 mvp = Projection * View * Model; // Remember, matrix multiplication is the other way around
</code></pre> <ul> <li>Third step: give it to GLSL</li> </ul> <pre><code class=language-c++>// Get a handle for our &quot;MVP&quot; uniform
// Only during the initialisation
GLuint MatrixID = glGetUniformLocation(programID, &quot;MVP&quot;);

// Send our transformation to the currently bound shader, in the &quot;MVP&quot; uniform
// This is done in the main loop since each model will have a different MVP matrix (At least for the M part)
glUniformMatrix4fv(MatrixID, 1, GL_FALSE, &amp;mvp[0][0]);
</code></pre> <ul> <li>Fourth step: use it in GLSL to transform our vertices in <code>SimpleVertexShader.vertexshader</code></li> </ul> <pre><code>// Input vertex data, different for all executions of this shader.
layout(location = 0) in vec3 vertexPosition_modelspace;

// Values that stay constant for the whole mesh.
uniform mat4 MVP;

void main(){
  // Output position of the vertex, in clip space: MVP * position
  gl_Position =  MVP * vec4(vertexPosition_modelspace,1);
}
</code></pre> <blockquote> <p>https://www.opengl-tutorial.org/beginners-tutorials/tutorial-3-matrices/</p> </blockquote> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../Data%20shared%20between%20CPU%20and%20GPU/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Data shared between CPU and GPU" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Data shared between CPU and GPU </div> </div> </a> <a href=../../../network/tcp/ class="md-footer__link md-footer__link--next" aria-label="Next: TCP" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> TCP </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.6c7ad80a.min.js></script> </body> </html>